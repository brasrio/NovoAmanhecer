<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Novo Amanhecer</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="assets/css/dashboard-admin.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar container">
            <a href="index.html" class="navbar-brand">
                <img src="assets/images/logo.svg" alt="Novo Amanhecer Logo" class="navbar-logo">
                <span class="navbar-title">Novo Amanhecer</span>
            </a>
            
            <button class="navbar-toggle" aria-label="Menu">
                <span class="navbar-toggle-icon"></span>
                <span class="navbar-toggle-icon"></span>
                <span class="navbar-toggle-icon"></span>
            </button>
            
            <ul class="navbar-menu">
                <li><a href="dashboard.html" class="navbar-link">Dashboard</a></li>
                <li><a href="dashboard-admin.html" class="navbar-link">Gerenciar UsuÃ¡rios</a></li>
                <li><button onclick="logout()" class="btn-logout" style="border: none;">Sair</button></li>
            </ul>
        </nav>
    </header>

    <!-- Dashboard Content -->
    <section class="dashboard">
        <div class="dashboard-container">
            <h1 style="color: #1e3a5f; margin-bottom: 2rem;">ğŸ‘‘ Painel Administrativo</h1>
            
            <!-- EstatÃ­sticas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsuarios">0</div>
                    <div class="stat-label">Total de UsuÃ¡rios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAdmins">0</div>
                    <div class="stat-label">Administradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCuidadores">0</div>
                    <div class="stat-label">Cuidadores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalClientes">0</div>
                    <div class="stat-label">Clientes</div>
                </div>
            </div>
            
            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Carregando usuÃ¡rios...</p>
            </div>
            
            <!-- Administradores -->
            <div id="adminsSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>ğŸ‘‘ Administradores</h2>
                    <span class="count-badge" id="adminCount">0</span>
                </div>
                <div id="adminsList"></div>
            </div>
            
            <!-- Cuidadores -->
            <div id="cuidadoresSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>ğŸ‘¨â€âš•ï¸ Cuidadores Profissionais</h2>
                    <span class="count-badge" id="cuidadorCount">0</span>
                </div>
                <div id="cuidadoresList"></div>
            </div>
            
            <!-- Clientes -->
            <div id="clientesSection" class="admin-section" style="display: none;">
                <div class="section-header">
                    <h2>ğŸ‘¤ Clientes / FamÃ­lias</h2>
                    <span class="count-badge" id="clienteCount">0</span>
                </div>
                <div id="clientesList"></div>
            </div>
        </div>
    </section>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // API_URL Ã© importado de config.js - detecta automaticamente localhost vs produÃ§Ã£o
        
        /**
         * Logout
         */
        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }
        
        /**
         * Verifica se Ã© admin
         */
        function verificarAdmin() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (user.role !== 'admin' && user.userType !== 'admin') {
                alert('Acesso negado! Apenas administradores.');
                window.location.href = 'dashboard.html';
                return false;
            }
            return true;
        }
        
        /**
         * Carrega todos os usuÃ¡rios
         */
        async function carregarUsuarios() {
            if (!verificarAdmin()) return;
            
            const user = JSON.parse(localStorage.getItem('user'));
            
            try {
                const response = await fetch(`${API_URL}/users`, {
                    headers: {
                        'x-user-id': user.id
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    organizarUsuarios(data.users);
                } else {
                    alert('Erro: ' + data.message);
                }
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('loading').innerHTML = 
                    '<p style="color: #e74c3c;">âŒ Erro ao carregar usuÃ¡rios. Verifique se o servidor estÃ¡ rodando.</p>';
            }
        }
        
        /**
         * Organiza usuÃ¡rios por tipo
         */
        function organizarUsuarios(users) {
            const admins = users.filter(u => u.role === 'admin' || u.userType === 'admin');
            const cuidadores = users.filter(u => u.role === 'cuidador' || u.userType === 'cuidador');
            const clientes = users.filter(u => (u.role === 'cliente' || u.userType === 'familia') && u.role !== 'admin' && u.userType !== 'admin' && u.role !== 'cuidador' && u.userType !== 'cuidador');
            
            // Atualiza estatÃ­sticas
            document.getElementById('totalUsuarios').textContent = users.length;
            document.getElementById('totalAdmins').textContent = admins.length;
            document.getElementById('totalCuidadores').textContent = cuidadores.length;
            document.getElementById('totalClientes').textContent = clientes.length;
            
            // Esconde loading
            document.getElementById('loading').style.display = 'none';
            
            // Renderiza listas
            if (admins.length > 0) {
                document.getElementById('adminsSection').style.display = 'block';
                document.getElementById('adminCount').textContent = admins.length;
                document.getElementById('adminsList').innerHTML = admins.map(u => criarCardUsuario(u, 'admin')).join('');
            }
            
            if (cuidadores.length > 0) {
                document.getElementById('cuidadoresSection').style.display = 'block';
                document.getElementById('cuidadorCount').textContent = cuidadores.length;
                document.getElementById('cuidadoresList').innerHTML = cuidadores.map(u => criarCardUsuario(u, 'cuidador')).join('');
            }
            
            if (clientes.length > 0) {
                document.getElementById('clientesSection').style.display = 'block';
                document.getElementById('clienteCount').textContent = clientes.length;
                document.getElementById('clientesList').innerHTML = clientes.map(u => criarCardUsuario(u, 'cliente')).join('');
            }
        }
        
        /**
         * Cria card de usuÃ¡rio
         */
        function criarCardUsuario(user, tipo) {
            const badges = {
                admin: '<span class="user-badge badge-admin">ğŸ‘‘ Admin</span>',
                cuidador: '<span class="user-badge badge-cuidador">ğŸ‘¨â€âš•ï¸ Cuidador</span>',
                cliente: '<span class="user-badge badge-cliente">ğŸ‘¤ Cliente</span>'
            };
            
            const dataFormatada = user.createdAt ? 
                new Date(user.createdAt).toLocaleDateString('pt-BR') : 'N/A';
            
            const cidadeCompleta = user.distrito && user.cidade ?
                `${user.cidade}, ${user.distrito}` : (user.cidade || 'N/A');
            
            // InformaÃ§Ãµes extras para cuidadores
            let infoCuidador = '';
            if (tipo === 'cuidador') {
                const temPerfil = user.valorHora || user.areasAtuacao || user.qualificacoes || user.fotoPerfil;
                if (temPerfil) {
                    infoCuidador = '<div style="background: #e8f8f8; padding: 1rem; border-radius: 8px; margin-top: 1rem;">';
                    infoCuidador += '<strong style="color: #3abebd;">Perfil Profissional:</strong><br>';
                    
                    if (user.valorHora) {
                        infoCuidador += `ğŸ’° <strong>â‚¬${user.valorHora}/hora</strong><br>`;
                    }
                    if (user.experiencia) {
                        infoCuidador += `â±ï¸ ${user.experiencia} anos de experiÃªncia<br>`;
                    }
                    if (user.areasAtuacao && user.areasAtuacao.length > 0) {
                        infoCuidador += `ğŸ“ Atende em: ${user.areasAtuacao.slice(0, 3).join(', ')}${user.areasAtuacao.length > 3 ? '...' : ''}<br>`;
                    }
                    if (user.qualificacoes && user.qualificacoes.length > 0) {
                        infoCuidador += `ğŸ“ ${user.qualificacoes.length} qualificaÃ§Ã£o(Ãµes)<br>`;
                    }
                    if (user.disponibilidade && user.disponibilidade.length > 0) {
                        infoCuidador += `ğŸ“… DisponÃ­vel ${user.disponibilidade.length} dia(s)/semana`;
                    }
                    
                    infoCuidador += '</div>';
                } else {
                    infoCuidador = '<div style="background: #fff3cd; padding: 0.75rem; border-radius: 8px; margin-top: 1rem; color: #856404;">';
                    infoCuidador += 'âš ï¸ Perfil profissional incompleto';
                    infoCuidador += '</div>';
                }
            }
            
            return `
                <div class="user-card ${tipo}-card">
                    <div class="user-header">
                        <div class="user-name">
                            ${user.fotoPerfil && tipo === 'cuidador' ? 
                                `<img src="${user.fotoPerfil}" alt="${user.nome}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 0.5rem; vertical-align: middle;">` : 
                                ''}
                            ${user.nome}
                        </div>
                        ${badges[tipo]}
                    </div>
                    <div class="user-info">
                        <div class="info-item">
                            <span>ğŸ“§</span>
                            <span>${user.email}</span>
                        </div>
                        <div class="info-item">
                            <span>ğŸ“±</span>
                            <span>${user.telefone || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span>ğŸ“</span>
                            <span>${cidadeCompleta}</span>
                        </div>
                        <div class="info-item">
                            <span>ğŸ“…</span>
                            <span>Cadastro: ${dataFormatada}</span>
                        </div>
                        ${user.isActive !== undefined ? `
                        <div class="info-item">
                            <span>${user.isActive ? 'ğŸŸ¢' : 'ğŸ”´'}</span>
                            <span>${user.isActive ? 'Ativo' : 'Inativo'}</span>
                        </div>
                        ` : ''}
                    </div>
                    ${infoCuidador}
                    <div class="user-actions">
                        <button class="btn-action btn-view" onclick="verDetalhes('${user.id}')">
                            ğŸ‘ï¸ Ver Detalhes
                        </button>
                        <button class="btn-action btn-edit" onclick="editarUsuario('${user.id}')">
                            âœï¸ Editar
                        </button>
                        ${user.role !== 'admin' && user.userType !== 'admin' ? `
                        <button class="btn-action btn-disable" onclick="toggleUsuario('${user.id}', ${user.isActive || false})">
                            ${user.isActive ? 'ğŸš« Desativar' : 'âœ… Ativar'}
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        /**
         * Ver detalhes do usuÃ¡rio
         */
        function verDetalhes(userId) {
            const users = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (user) {
                const detalhes = JSON.stringify(user, null, 2);
                alert(`Detalhes do UsuÃ¡rio:\n\n${detalhes}`);
                console.log('Detalhes completos:', user);
            }
        }
        
        /**
         * Editar usuÃ¡rio (em desenvolvimento)
         */
        function editarUsuario(userId) {
            alert('ğŸ”¨ Funcionalidade de ediÃ§Ã£o em desenvolvimento!\n\nEm breve vocÃª poderÃ¡ editar:\n- Dados cadastrais\n- PermissÃµes\n- Status');
        }
        
        /**
         * Ativar/Desativar usuÃ¡rio (em desenvolvimento)
         */
        function toggleUsuario(userId, isActive) {
            const acao = isActive ? 'desativar' : 'ativar';
            if (confirm(`Tem certeza que deseja ${acao} este usuÃ¡rio?`)) {
                alert(`ğŸ”¨ Funcionalidade em desenvolvimento!\n\nEm breve vocÃª poderÃ¡ ${acao} usuÃ¡rios.`);
            }
        }
        
        // Carrega usuÃ¡rios ao iniciar
        window.addEventListener('load', () => {
            carregarUsuarios();
        });
    </script>
</body>
</html>

